define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-a8ce88a9","./Transforms-9ac5213c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./GeometryAttribute-ded8350c","./GeometryAttributes-4fcfcf40","./AttributeCompression-88d6db09","./GeometryPipeline-bab42799","./EncodedCartesian3-e3c09f89","./IndexDatatype-53503fee","./IntersectionTests-51503d7b","./Plane-29afec1f","./VertexFormat-7572c785","./arrayRemoveDuplicates-ebc732b0","./BoundingRectangle-4c901c27","./EllipsoidTangentPlane-97448adb","./EllipsoidRhumbLine-a69f63ad","./PolygonPipeline-9522bda7","./PolylineVolumeGeometryLibrary-4f6891a0","./EllipsoidGeodesic-9bc1521b","./PolylinePipeline-45af48b7"],function(c,e,i,u,T,t,n,R,A,D,r,O,a,I,o,l,g,s,d,p,y,B,m,h,f){"use strict";var v={};function S(e,t){c.defined(v[e])||(v[e]=!0,console.warn(c.defaultValue(t,e)))}function b(e){var t=(e=c.defaultValue(e,c.defaultValue.EMPTY_OBJECT)).polylinePositions,n=e.shapePositions;this._positions=t,this._shape=n,this._ellipsoid=u.Ellipsoid.clone(c.defaultValue(e.ellipsoid,u.Ellipsoid.WGS84)),this._cornerType=c.defaultValue(e.cornerType,m.CornerType.ROUNDED),this._vertexFormat=g.VertexFormat.clone(c.defaultValue(e.vertexFormat,g.VertexFormat.DEFAULT)),this._granularity=c.defaultValue(e.granularity,i.CesiumMath.RADIANS_PER_DEGREE),this._workerName="createPolylineVolumeGeometry";var r=1+t.length*u.Cartesian3.packedLength;r+=1+n.length*u.Cartesian2.packedLength,this.packedLength=r+u.Ellipsoid.packedLength+g.VertexFormat.packedLength+2}S.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",S.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",S.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",S.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored",b.pack=function(e,t,n){var r;n=c.defaultValue(n,0);var i=e._positions,a=i.length;for(t[n++]=a,r=0;r<a;++r,n+=u.Cartesian3.packedLength)u.Cartesian3.pack(i[r],t,n);var o=e._shape,a=o.length;for(t[n++]=a,r=0;r<a;++r,n+=u.Cartesian2.packedLength)u.Cartesian2.pack(o[r],t,n);return u.Ellipsoid.pack(e._ellipsoid,t,n),n+=u.Ellipsoid.packedLength,g.VertexFormat.pack(e._vertexFormat,t,n),n+=g.VertexFormat.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};var E=u.Ellipsoid.clone(u.Ellipsoid.UNIT_SPHERE),x=new g.VertexFormat,P={polylinePositions:void 0,shapePositions:void 0,ellipsoid:E,vertexFormat:x,cornerType:void 0,granularity:void 0};b.unpack=function(e,t,n){t=c.defaultValue(t,0);for(var r=e[t++],i=new Array(r),a=0;a<r;++a,t+=u.Cartesian3.packedLength)i[a]=u.Cartesian3.unpack(e,t);r=e[t++];var o=new Array(r);for(a=0;a<r;++a,t+=u.Cartesian2.packedLength)o[a]=u.Cartesian2.unpack(e,t);var l=u.Ellipsoid.unpack(e,t,E);t+=u.Ellipsoid.packedLength;var s=g.VertexFormat.unpack(e,t,x);t+=g.VertexFormat.packedLength;var d=e[t++],p=e[t];return c.defined(n)?(n._positions=i,n._shape=o,n._ellipsoid=u.Ellipsoid.clone(l,n._ellipsoid),n._vertexFormat=g.VertexFormat.clone(s,n._vertexFormat),n._cornerType=d,n._granularity=p,n):(P.polylinePositions=i,P.shapePositions=o,P.cornerType=d,P.granularity=p,new b(P))};var _=new d.BoundingRectangle;return b.createGeometry=function(e){var t=e._positions,n=s.arrayRemoveDuplicates(t,u.Cartesian3.equalsEpsilon),r=e._shape,r=m.PolylineVolumeGeometryLibrary.removeDuplicatesFromShape(r);if(!(n.length<2||r.length<3)){B.PolygonPipeline.computeWindingOrder2D(r)===B.WindingOrder.CLOCKWISE&&r.reverse();var i=d.BoundingRectangle.fromPoints(r,_);return function(e,t,n,r){var i=new D.GeometryAttributes;r.position&&(i.position=new A.GeometryAttribute({componentDatatype:R.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e}));var a,o,l,s,d,p=t.length,c=e.length/3,u=(c-2*p)/(2*p),g=B.PolygonPipeline.triangulate(t),y=(u-1)*p*6+2*g.length,m=I.IndexDatatype.createTypedArray(c,y),h=2*p,f=0;for(k=0;k<u-1;k++){for(a=0;a<p-1;a++)d=(o=2*a+k*p*2)+h,s=(l=o+1)+h,m[f++]=l,m[f++]=o,m[f++]=s,m[f++]=s,m[f++]=o,m[f++]=d;s=(l=(o=2*p-2+k*p*2)+1)+h,d=o+h,m[f++]=l,m[f++]=o,m[f++]=s,m[f++]=s,m[f++]=o,m[f++]=d}if(r.st||r.tangent||r.bitangent){for(var v,b,E=new Float32Array(2*c),x=1/(u-1),P=1/n.height,_=n.height/2,w=0,k=0;k<u;k++){for(v=k*x,b=P*(t[0].y+_),E[w++]=v,E[w++]=b,a=1;a<p;a++)b=P*(t[a].y+_),E[w++]=v,E[w++]=b,E[w++]=v,E[w++]=b;b=P*(t[0].y+_),E[w++]=v,E[w++]=b}for(a=0;a<p;a++)v=0,b=P*(t[a].y+_),E[w++]=v,E[w++]=b;for(a=0;a<p;a++)v=(u-1)*x,b=P*(t[a].y+_),E[w++]=v,E[w++]=b;i.st=new A.GeometryAttribute({componentDatatype:R.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(E)})}var C=c-2*p;for(k=0;k<g.length;k+=3){var L=g[k]+C,V=g[k+1]+C,F=g[k+2]+C;m[f++]=L,m[f++]=V,m[f++]=F,m[f++]=F+p,m[f++]=V+p,m[f++]=L+p}var G=new A.Geometry({attributes:i,indices:m,boundingSphere:T.BoundingSphere.fromVertices(e),primitiveType:A.PrimitiveType.TRIANGLES});if(r.normal&&(G=O.GeometryPipeline.computeNormal(G)),r.tangent||r.bitangent){try{G=O.GeometryPipeline.computeTangentAndBitangent(G)}catch(e){S("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}r.tangent||(G.attributes.tangent=void 0),r.bitangent||(G.attributes.bitangent=void 0),r.st||(G.attributes.st=void 0)}return G}(m.PolylineVolumeGeometryLibrary.computePositions(n,r,i,e,!0),r,i,e._vertexFormat)}},b.exportGeometryToOBJ=function(e){for(var t=this.createGeometry(e),n="",r=t.attributes.position.values,i=0;i<r.length;i++)n+="v "+r[i]+" "+r[i+1]+" "+r[i+2]+"\n",i+=2;for(var a=t.attributes.normal.values,i=0;i<a.length;i++)n+="vn "+a[i]+" "+a[i+1]+" "+a[i+2]+"\n",i+=2;for(var o=t.indices,i=0;i<o.length;i++)n+="f "+(o[i]+1)+"//"+(o[i]+1)+" "+(o[i+1]+1)+"//"+(o[i+1]+1)+" "+(o[i+2]+1)+"//"+(o[i+2]+1)+"\n",i+=2;var l=new Blob([n],{type:"obj/plain"}),s=document.createElement("a");s.download="exporter.obj",s.href=window.URL.createObjectURL(l),s.textContent="Download ready",s.dataset.downloadurl=["obj/plain",s.download,s.href].join(":"),s.click()},function(e,t){return c.defined(t)&&(e=b.unpack(e,t)),e._ellipsoid=u.Ellipsoid.clone(e._ellipsoid),b.createGeometry(e)}});
