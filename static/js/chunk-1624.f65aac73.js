(this["webpackJsonp"] = this["webpackJsonp"] || []).push([["chunk-1624"],{

/***/ "1UGi":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-0!./node_modules/css-loader??ref--11-1!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/lib??ref--11-2!./node_modules/sass-loader/lib/loader.js??ref--11-3!./node_modules/vue-loader/lib??vue-loader-options!./src/views/project/BIM/planRecord/components/myTree/index.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),

/***/ "9pIp":
/*!**********************************************************************!*\
  !*** ./src/views/project/BIM/planRecord/components/myTree/index.vue ***!
  \**********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _index_vue_vue_type_template_id_5fdef634___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index.vue?vue&type=template&id=5fdef634& */ "EWKL");
/* harmony import */ var _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index.vue?vue&type=script&lang=js& */ "AgDH");
/* empty/unused harmony star reexport *//* harmony import */ var _index_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./index.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& */ "RmZ6");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "KHd+");






/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__["default"])(
  _index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _index_vue_vue_type_template_id_5fdef634___WEBPACK_IMPORTED_MODULE_0__["render"],
  _index_vue_vue_type_template_id_5fdef634___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

component.options.__file = "index.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "AgDH":
/*!***********************************************************************************************!*\
  !*** ./src/views/project/BIM/planRecord/components/myTree/index.vue?vue&type=script&lang=js& ***!
  \***********************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_happypack_loader_js_id_happyBabel_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../node_modules/happypack/loader.js?id=happyBabel!../../../../../../../node_modules/vue-loader/lib??vue-loader-options!./index.vue?vue&type=script&lang=js& */ "wNQX");
/* empty/unused harmony star reexport */ /* harmony default export */ __webpack_exports__["default"] = (_node_modules_happypack_loader_js_id_happyBabel_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__["default"]); 

/***/ }),

/***/ "EWKL":
/*!*****************************************************************************************************!*\
  !*** ./src/views/project/BIM/planRecord/components/myTree/index.vue?vue&type=template&id=5fdef634& ***!
  \*****************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_template_id_5fdef634___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../node_modules/vue-loader/lib??vue-loader-options!./index.vue?vue&type=template&id=5fdef634& */ "h1WY");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_template_id_5fdef634___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_template_id_5fdef634___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "RmZ6":
/*!******************************************************************************************************************************!*\
  !*** ./src/views/project/BIM/planRecord/components/myTree/index.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& ***!
  \******************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-0!../../../../../../../node_modules/css-loader??ref--11-1!../../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../node_modules/postcss-loader/lib??ref--11-2!../../../../../../../node_modules/sass-loader/lib/loader.js??ref--11-3!../../../../../../../node_modules/vue-loader/lib??vue-loader-options!./index.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& */ "1UGi");
/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ "h1WY":
/*!***********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./src/views/project/BIM/planRecord/components/myTree/index.vue?vue&type=template&id=5fdef634& ***!
  \***********************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:"myTree",staticClass:"my-tree"},[_c('el-tree',{ref:"tree",attrs:{"props":_vm.defaultProps,"highlight-current":true,"expand-on-click-node":false,"node-key":"id","load":_vm.loadNode,"default-expanded-keys":_vm.defaultExpandedKeys,"lazy":""},on:{"node-click":_vm.handleNodeClick,"node-contextmenu":_vm.nodeContextmenu,"node-expand":_vm.handleNodeExpand,"node-collapse":_vm.handleNodeCollapse},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var node = ref.node;
var data = ref.data;
return _c('span',{staticClass:"custom-tree-node"},[_c('i',{staticClass:"icon iconfont",class:node.expanded?'iconwenjianjia_kai':'iconwenjianjia_guan'}),_vm._v(" "),_c('span',{attrs:{"title":node.label}},[_vm._v(_vm._s(node.label))])])}}])}),_vm._v(" "),_c('myContextMenu',{ref:"myContextMenu",attrs:{"show":_vm.showRightMenu,"menu-list":_vm.menuList},on:{"update:show":function($event){_vm.showRightMenu=$event}}}),_vm._v(" "),_c('el-dialog',{directives:[{name:"dragDialog",rawName:"v-dragDialog"}],attrs:{"title":_vm.textMap[_vm.currentState],"visible":_vm.dialogVisible,"close-on-click-modal":false},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c('el-form',{ref:"categoryForm",attrs:{"rules":_vm.categoryRules,"model":_vm.categoryForm,"label-position":"center","size":"small","label-width":"100px"}},[_c('el-row',[_c('el-col',{attrs:{"span":16}},[(_vm.currentState!='update')?_c('el-form-item',{attrs:{"label":"目录类型","prop":"type"}},[_c('el-select',{attrs:{"placeholder":"请目录类型","clearable":""},on:{"change":_vm.changeType},model:{value:(_vm.categoryForm.type),callback:function ($$v) {_vm.$set(_vm.categoryForm, "type", $$v)},expression:"categoryForm.type"}},_vm._l((_vm.dictMap['dbs_category_type']),function(item){return _c('el-option',{key:item.code,attrs:{"label":item.name,"value":item.code}})}),1)],1):_vm._e(),_vm._v(" "),(_vm.categoryForm.type == ''||_vm.currentState=='update')?_c('el-form-item',{attrs:{"label":"目录名称","prop":"name"}},[_c('el-input',{staticClass:"filter-item",attrs:{"type":"text","placeholder":"请输入目录名称"},model:{value:(_vm.categoryForm.name),callback:function ($$v) {_vm.$set(_vm.categoryForm, "name", $$v)},expression:"categoryForm.name"}})],1):_vm._e(),_vm._v(" "),(_vm.categoryForm.type != ''&&_vm.currentState!='update')?_c('el-form-item',{attrs:{"label":_vm.arrLabel,"prop":"list"}},[_c('el-select',{attrs:{"placeholder":_vm.arrPlaceholder,"clearable":"","multiple":""},model:{value:(_vm.categoryForm.list),callback:function ($$v) {_vm.$set(_vm.categoryForm, "list", $$v)},expression:"categoryForm.list"}},_vm._l((_vm.selectList),function(item){return _c('el-option',{key:_vm.categoryForm.type === 'work_point' || _vm.categoryForm.type === 'work_point_area' ? item.id : item.code,attrs:{"label":item.name,"value":_vm.categoryForm.type === 'work_point' || _vm.categoryForm.type === 'work_point_area' ? item.id : item.code}})}),1)],1):_vm._e(),_vm._v(" "),(_vm.showPermission&&_vm.currentState!='update')?_c('el-form-item',{attrs:{"label":"是否继承权限","prop":"inherit"}},[_c('el-radio-group',{model:{value:(_vm.categoryForm.inherit),callback:function ($$v) {_vm.$set(_vm.categoryForm, "inherit", $$v)},expression:"categoryForm.inherit"}},[_c('el-radio',{attrs:{"label":1}},[_vm._v("是")]),_vm._v(" "),_c('el-radio',{attrs:{"label":2}},[_vm._v("否")])],1)],1):_vm._e(),_vm._v(" "),_c('el-form-item',{attrs:{"label":"目录备注","prop":"remark"}},[_c('el-input',{staticClass:"filter-item",attrs:{"type":"textarea","placeholder":"请输入目录备注"},model:{value:(_vm.categoryForm.remark),callback:function ($$v) {_vm.$set(_vm.categoryForm, "remark", $$v)},expression:"categoryForm.remark"}})],1)],1)],1)],1),_vm._v(" "),_c('div',{staticClass:"dialog-footer",attrs:{"slot":"footer"},slot:"footer"},[_c('el-button',{on:{"click":function($event){_vm.dialogVisible = false}}},[_vm._v("取消")]),_vm._v(" "),_c('el-button',{directives:[{name:"waves",rawName:"v-waves"}],attrs:{"type":"primary","loading":_vm.loading},on:{"click":_vm.save}},[_vm._v("提交")])],1)],1)],1)}
var staticRenderFns = []



/***/ }),

/***/ "wNQX":
/*!**************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/happypack/loader.js?id=happyBabel!./node_modules/vue-loader/lib??vue-loader-options!./src/views/project/BIM/planRecord/components/myTree/index.vue?vue&type=script&lang=js& ***!
  \**************************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babel-runtime/helpers/toConsumableArray */ "m1cH");
/* harmony import */ var babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! babel-runtime/helpers/extends */ "QbLZ");
/* harmony import */ var babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/api/project/bimFloder */ "lC0u");
/* harmony import */ var _api_project_planRecord__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/api/project/planRecord */ "ufAr");
/* harmony import */ var _components_myContextMenu__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../components/myContextMenu */ "AAk3");
/* harmony import */ var vuex__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! vuex */ "L2JU");
/* harmony import */ var _api_project_workPoint__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/api/project/workPoint */ "15Ai");


//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//






/* harmony default export */ __webpack_exports__["default"] = ({
  name: 'MyTree',
  components: {
    MyContextMenu: _components_myContextMenu__WEBPACK_IMPORTED_MODULE_4__["default"]
  },
  data: function data() {
    return {
      textMap: { add: '新增文件夹', update: '修改文件夹' },
      currentState: 'add',
      defaultProps: {
        label: 'name',
        isLeaf: 'leaf'
      },
      rightClickData: {},
      rightClickNode: null,
      leftClickNode: {},
      treeList: [],
      menuList: [],
      dialogVisible: false,
      categoryRules: {
        name: [{ required: true, message: '请输入目录名称', trigger: 'blur' }]
      },
      categoryForm: {
        id: '',
        parentId: '',
        name: '',
        remark: '',
        code: '',
        type: '',
        list: [],
        types: [],
        inherit: 2
      },
      showRightMenu: false,
      allMenuList: [{
        name: '新建子文件夹',
        click: this.addFloder,
        code: 'dbs_category_add'
      }, {
        name: '修改',
        click: this.rename,
        code: 'dbs_category_update'
      }, {
        name: '上移',
        click: this.updateToUp,
        code: 'dbs_sy',
        isNotAuth: true
      }, {
        name: '下移',
        click: this.updateToDown,
        code: 'dbs_y',
        isNotAuth: true
      }, {
        name: '升级',
        click: this.updateToUpLevel,
        code: 'dbs_sj',
        isNotAuth: true
      }, {
        name: '降级',
        click: this.updateToDownLevel,
        code: 'dbs_jj',
        isNotAuth: true
      }, {
        name: '置顶',
        click: this.updateToTop,
        code: 'dbs_top',
        isNotAuth: true
      }, {
        name: '置底',
        click: this.updateToBottom,
        code: 'dbs_bottom',
        isNotAuth: true
      }, {
        name: '权限管理',
        code: 'dbs_category_permission',
        click: this.deployAuth
      }, {
        code: 'dbs_category_delete',
        name: '删除',
        click: this.deleteFloder
      }],
      arrLabel: '',
      arrPlaceholder: '',
      selectList: [],
      rootNode: { name: '成果目录分解结构' },
      currentNode: null,
      currentNodeResolve: null,
      // 由于业务要求先写死
      defaultExpandedKeys: [12, 28],
      showPermission: false,
      isDisablePrivilege: false,
      isShowInPlan: true
    };
  },

  computed: babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1___default()({}, Object(vuex__WEBPACK_IMPORTED_MODULE_5__["mapGetters"])(['loading', 'dictMap', 'projectButtonPrivileges', 'planCurrentCategoryAuth', 'planCurrentBreadcrumb', 'planExpandedKeys', 'planLastClickNode'])),
  watch: {
    // 监听面包屑
    planCurrentBreadcrumb: function planCurrentBreadcrumb(val) {
      this.$refs.tree.setCurrentNode(val);
      var node = this.$refs.tree.getNode(val.id);
      if (!node.loaded) {
        node.expand();
      }
      this.breadcrumb = [];
      this.changeBreadcrumb(node);
      this.$store.dispatch('setPlanBreadcrumb', this.breadcrumb);
    },
    isShowInPlan: function isShowInPlan(val) {
      var index = this.menuList.findIndex(function (item) {
        return item.code === 'dbs_category_plan';
      });
      if (index >= 0) {
        if (val === true) {
          this.menuList[index].name = '取消在计划中显示';
        } else {
          this.menuList[index].name = '在计划中显示';
        }
      }
    }
  },
  mounted: function mounted() {
    if (this.planExpandedKeys.length) {
      this.defaultExpandedKeys = this.planExpandedKeys;
    } else {
      this.$store.dispatch('setPlanExpandedKeys', this.defaultExpandedKeys);
    }
    // if (this.planLastClickNode.data) {
    //   this.handleNodeClick(this.planLastClickNode.data, this.planLastClickNode.node)
    // }
    var _rNode = this.currentNode.childNodes[0];
    _rNode.checked = true;
    _rNode.expanded = true;
    _rNode.loadData();
  },

  methods: {
    loadNode: function loadNode(node, resolve) {
      var _this = this;

      this.currentNodeResolve = resolve;
      this.currentNode = node;
      if (node.level === 0) {
        return resolve([this.rootNode]);
      } else {
        // 获取项目目录结构
        Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["categoryTreeData"])({ id: node.data ? node.data.id : null }).then(function (res) {
          if (res.success) {
            if (_this.$route.name === 'PlanRecord') {
              var result = res.result.filter(function (item) {
                if (item.entity.showStatus) {
                  return item;
                }
              });
              return resolve(result);
            } else {
              return resolve(res.result);
            }
          }
        });
      }
    },

    // 点击节点事件
    handleNodeClick: function handleNodeClick(data, node) {
      var _this2 = this;

      this.showRightMenu = false;
      this.$store.dispatch('setPlanLeftClickNode', data);
      this.$store.dispatch('setPlanRightClickNode', data);
      this.leftClickNode = data;
      this.breadcrumb = [];
      this.changeBreadcrumb(node);
      this.$store.dispatch('setPlanBreadcrumb', this.breadcrumb);
      this.$store.dispatch('setPlanShowAuthTable', false);
      this.$store.dispatch('setPlanIsDoc', false);
      this.$store.dispatch('setPlanAuthInfoVisible', false);
      this.listData = [];
      if (!node.loaded) {
        if (this.planExpandedKeys.indexOf(data.id)) {
          var tempExpandedKeys = [].concat(babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(this.planExpandedKeys), [data.id]);
          this.$store.dispatch('setPlanExpandedKeys', tempExpandedKeys);
        }
        node.expand();
      }
      if (data.entity) {
        Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["currCategoryActions"])({ id: data.id }).then(function (res) {
          if (res.success) {
            _this2.$store.dispatch('setPlanCurrentCategoryAuth', res.result);
          }
        });
      }
      this.$store.dispatch('setPlanLastClickNode', { data: data, node: node });
      // this.getListData(data)
    },

    // 改变面包屑路径
    changeBreadcrumb: function changeBreadcrumb(node) {
      this.breadcrumb.unshift(node.data);
      if (node.data.entity && node.parent) {
        this.changeBreadcrumb(node.parent);
      }
    },

    // 获取列表数据
    getListData: function getListData(data) {
      var _this3 = this;

      this.list.forEach(function (item) {
        if (item.parentId === data.id) {
          if (item.isLeaf) {
            _this3.listData.push(item);
          } else {
            _this3.getListData(item);
          }
        }
      });
    },

    // tree右键点击事件
    nodeContextmenu: function nodeContextmenu(event, data, node) {
      var _this4 = this;

      // 获取该目录权限
      this.menuList = [];
      if (data.entity) {
        Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["currCategoryActions"])({ id: data.id }).then(function (res) {
          if (res.success) {
            _this4.$store.dispatch('setPlanCurrentCategoryAuth', res.result);
            _this4.allMenuList.forEach(function (item) {
              if (item.isNotAuth) {
                // 判断有无配置项目里权限
                if (_this4.projectButtonPrivileges.findIndex(function (p) {
                  return p === 'P_dbs_category_move';
                }) !== -1) {
                  // 判断是第几层，第二层去掉升级
                  if (item.code === 'dbs_sj') {
                    if (data.entity.parentId) {
                      _this4.menuList.push(item);
                    }
                  } else {
                    _this4.menuList.push(item);
                  }
                }
              } else {
                if (res.result.findIndex(function (r) {
                  return r.code === item.code;
                }) !== -1) {
                  _this4.menuList.push(item);
                }
              }
            });
            if (_this4.$route.name === 'BIMFloder' && _this4.projectButtonPrivileges.findIndex(function (p) {
              return p === 'P_dbs_show_plan';
            }) !== -1) {
              _this4.isDisablePrivilege = false;
              _this4.menuList.push({
                code: 'dbs_category_plan',
                name: '取消在计划中显示',
                click: _this4.changeShowInPlan,
                param: data
              });
            } else {
              _this4.isDisablePrivilege = true;
            }
            _this4.isShowInPlan = data.entity.showStatus;
            _this4.nodeContextmenuUtil(event, data, node);
          }
        });
      } else {
        if (this.projectButtonPrivileges.findIndex(function (item) {
          return item === 'P_dbs_category_add';
        }) !== -1) {
          this.menuList.push({ name: '新建子文件夹', click: this.addFloder });
        }
        if (this.projectButtonPrivileges.findIndex(function (item) {
          return item === 'P_dbs_permission';
        }) !== -1) {
          this.menuList.push({ name: '权限管理', click: this.deployAuth });
        }
        this.nodeContextmenuUtil(event, data, node);
      }
    },
    nodeContextmenuUtil: function nodeContextmenuUtil(event, data, node) {
      this.showRightMenu = true;
      this.$store.dispatch('setPlanContextMenuType', 'tree');
      this.$store.dispatch('setPlanShowAuthTable', false);
      this.$store.dispatch('setPlanRightClickNode', data);
      this.$store.dispatch('setPlanIsDoc', false);
      this.rightClickData = data;
      this.rightClickNode = node;
      this.$refs.tree.setCurrentKey(data.id);
      this.breadcrumb = [];
      this.changeBreadcrumb(node);
      this.$store.dispatch('setPlanBreadcrumb', this.breadcrumb);
      // document.getElementsByClassName('myContextMenu')[0].style.display = ''
      var clientY = null;
      if (document.getElementById('app').clientHeight - event.clientY < 300) {
        clientY = event.clientY - 300;
      } else {
        clientY = event.clientY;
      }
      document.getElementsByClassName('myContextMenu')[0].style.top = clientY + 'px';
      document.getElementsByClassName('myContextMenu')[0].style.left = event.clientX + 'px';
    },
    handleNodeExpand: function handleNodeExpand(data, node) {
      var tempExpandedKeys = [].concat(babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(this.planExpandedKeys), [data.id]);
      this.$store.dispatch('setPlanExpandedKeys', tempExpandedKeys);
    },
    handleNodeCollapse: function handleNodeCollapse(data, node) {
      var tempExpandedKeys = [].concat(babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(this.planExpandedKeys)).filter(function (item) {
        return item !== data.id;
      });
      this.$store.dispatch('setPlanExpandedKeys', tempExpandedKeys);
    },

    // 新建子文件
    addFloder: function addFloder() {
      // 判断是否有权限设置
      if (this.planCurrentCategoryAuth.findIndex(function (item) {
        return item.code === 'dbs_category_permission';
      }) !== -1) {
        this.showPermission = true;
      } else {
        this.showPermission = false;
      }
      this.reset();
      this.currentState = 'add';
      this.showRightMenu = false;
      this.dialogVisible = true;
    },
    deployAuth: function deployAuth() {
      this.$store.dispatch('setPlanInfoVisible', false);
      this.$store.dispatch('setPlanShowAuthTable', true);
      this.$store.dispatch('setPlanIsDoc', false);
    },

    // 保存文件夹
    save: function save() {
      var _this5 = this;

      if (this.currentState === 'add') {
        this.categoryForm.parentId = this.rightClickData.id;
      }
      this.$refs['categoryForm'].validate(function (valid) {
        if (valid) {
          if (_this5.categoryForm.inherit === 1) {
            _this5.categoryForm.inherit = true;
          }
          _this5.loading = true;
          // 组装数据
          if (_this5.currentState === 'add') {
            _this5.getParams();
          }
          Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["saveCategory"])(_this5.categoryForm).then(function (res) {
            if (res.success) {
              _this5.$message.success('保存成功');
              if (_this5.currentState === 'update') {
                _this5.rightClickNode.data.name = _this5.categoryForm.name;
                _this5.rightClickData.entity.remark = _this5.categoryForm.remark;
                _this5.rightClickData.entity.name = _this5.categoryForm.name;
              } else {
                // 保存成功后渲染树
                _this5.applyTree();
                // this.$refs.tree.append(res.result, this.rightClickNode)
                _this5.rightClickNode.isLeaf = false;
              }
              _this5.dialogVisible = false;
              _this5.reset();
            }
            _this5.loading = false;
          });
        }
      });
    },
    reset: function reset() {
      this.categoryForm = {
        id: '',
        parentId: '',
        name: '',
        remark: '',
        code: '',
        type: '',
        inherit: 2,
        list: [],
        types: []
      };
    },
    getParams: function getParams() {
      var _this6 = this;

      var temp = null;
      if (this.categoryForm.type === 'work_point_area' || this.categoryForm.type === 'work_point') {
        this.categoryForm.list.forEach(function (item) {
          temp = _this6.selectList.find(function (select) {
            return select.id === item;
          });
          if (temp) {
            _this6.categoryForm.types.push({ name: temp.name, id: temp.id });
          }
        });
      } else {
        this.categoryForm.list.forEach(function (item) {
          temp = _this6.selectList.find(function (select) {
            return select.code === item;
          });
          if (temp) {
            _this6.categoryForm.types.push({ name: temp.name, code: temp.code });
          }
        });
      }
    },
    applyTree: function applyTree() {
      var _this7 = this;

      // 如果未加载节点则把他变为非叶子节点
      if (!this.rightClickNode.loaded) {
        this.rightClickNode.isLeaf = false;
        return false;
      }
      Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["categoryTreeData"])({
        id: this.rightClickData.entity ? this.categoryForm.parentId : null
      }).then(function (res) {
        if (res.success) {
          res.result.forEach(function (item) {
            if (_this7.rightClickNode.childNodes.findIndex(function (child) {
              return child.data.id === item.id;
            }) === -1) {
              _this7.$refs.tree.append(item, _this7.rightClickNode);
            }
          });
        }
      });
    },

    // 重命名
    rename: function rename() {
      this.currentState = 'update';
      this.showRightMenu = false;
      this.dialogVisible = true;
      this.categoryForm = babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1___default()({}, this.rightClickData.entity);
    },

    // 删除文件
    deleteFloder: function deleteFloder() {
      var _this8 = this;

      this.showRightMenu = false;
      this.$confirm('是否确定删除该文件夹?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(function () {
        Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["deleteCategory"])({ id: _this8.rightClickData.id }).then(function (response) {
          if (response.success) {
            _this8.$refs.tree.remove(_this8.rightClickNode);
            _this8.$message.success('删除成功');
          }
        });
      });
    },

    // 属性
    goAttribute: function goAttribute() {},

    // 改变目录类型
    changeType: function changeType() {
      var _this9 = this;

      // 判断选择类型
      switch (this.categoryForm.type) {
        // 成果类型
        case 'dbs_type':
          this.arrLabel = '成果类型';
          this.arrPlaceholder = '请选择成果类型';
          this.selectList = this.dictMap[this.categoryForm.type];
          this.categoryRules = {
            list: [{ required: true, message: '请选择成果类型', trigger: 'change' }]
          };
          break;
        // 阶段
        case 'project_phase':
          this.arrLabel = '阶段';
          this.arrPlaceholder = '请选择阶段';
          this.selectList = this.dictMap[this.categoryForm.type];
          this.categoryRules = {
            list: [{ required: true, message: '请选择阶段', trigger: 'change' }]
          };
          break;
        // 工点
        case 'work_point':
          this.arrLabel = '工点';
          this.arrPlaceholder = '请选择工点';
          this.categoryRules = {
            list: [{ required: true, message: '请选择工点', trigger: 'change' }]
          };
          Object(_api_project_workPoint__WEBPACK_IMPORTED_MODULE_6__["getWorkPointList"])({}).then(function (res) {
            if (res.success) {
              _this9.selectList = res.result.list;
            }
          });
          break;
        // 专业
        case 'project_major':
          this.arrLabel = '专业';
          this.arrPlaceholder = '请选择专业';
          this.selectList = this.dictMap[this.categoryForm.type];
          this.categoryRules = {
            list: [{ required: true, message: '请选择专业', trigger: 'change' }]
          };
          break;
        // 区域
        case 'work_point_area':
          this.arrLabel = '工点区域';
          this.arrPlaceholder = '请选择工点区域';
          this.categoryRules = {
            list: [{ required: true, message: '请选择工点区域', trigger: 'change' }]
          };
          if (!this.rightClickData.entity || !this.rightClickData.entity.workPointId) {
            this.$message.warning('该目录不是工点目录，不能创建区域');
            this.selectList = [];
          } else {
            Object(_api_project_workPoint__WEBPACK_IMPORTED_MODULE_6__["getWorkPointAreaList"])({
              workPointId: this.rightClickData.entity.workPointId
            }).then(function (res) {
              if (res.success) {
                _this9.selectList = res.result.list;
              }
            });
          }
          break;
        // 应用点
        case 'apply_point':
          this.arrLabel = '应用点';
          this.arrPlaceholder = '请选择应用点';
          this.selectList = this.dictMap[this.categoryForm.type];
          this.categoryRules = {
            list: [{ required: true, message: '请选择应用点', trigger: 'change' }]
          };
          break;
        // 模型类型
        case 'bim_type':
          this.arrLabel = '模型类型';
          this.arrPlaceholder = '请选择模型类型';
          this.selectList = this.dictMap[this.categoryForm.type];
          this.categoryRules = {
            list: [{ required: true, message: '请选择模型类型', trigger: 'change' }]
          };
          break;
        default:
          this.categoryRules = {
            name: [{ required: true, message: '请输入目录名称', trigger: 'blur' }]
          };
      }
    },
    updateToUp: function updateToUp() {
      var _this10 = this;

      Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["updateToUp"])({ id: this.rightClickData.id }).then(function (res) {
        if (res.success) {
          _this10.refeshParentNode();
        }
      });
    },
    updateToTop: function updateToTop() {
      var _this11 = this;

      Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["updateToTop"])({ id: this.rightClickData.id }).then(function (res) {
        if (res.success) {
          _this11.refeshParentNode();
        }
      });
    },
    updateToUpLevel: function updateToUpLevel() {
      var _this12 = this;

      Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["updateToUpLevel"])({ id: this.rightClickData.id }).then(function (res) {
        if (res.success) {
          _this12.refeshParentNode(true);
        }
      });
    },
    updateToDownLevel: function updateToDownLevel() {
      var _this13 = this;

      Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["updateToDownLevel"])({ id: this.rightClickData.id }).then(function (res) {
        if (res.success) {
          _this13.refeshParentNode();
        }
      });
    },
    updateToDown: function updateToDown() {
      var _this14 = this;

      Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["updateToDown"])({ id: this.rightClickData.id }).then(function (res) {
        if (res.success) {
          _this14.refeshParentNode();
        }
      });
    },
    updateToBottom: function updateToBottom() {
      var _this15 = this;

      Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_2__["updateToBottom"])({ id: this.rightClickData.id }).then(function (res) {
        if (res.success) {
          _this15.refeshParentNode();
        }
      });
    },
    refeshParentNode: function refeshParentNode() {
      var flag = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

      var node = this.$refs.tree.getNode(this.rightClickData.entity.parentId);
      if (node) {
        node.loaded = false;
        node.expand();
        if (flag) {
          var parentNode = this.$refs.tree.getNode(node.data.entity.parentId);
          if (parentNode) {
            parentNode.loaded = false;
            parentNode.expand();
          }
        }
      }
    },
    changeShowInPlan: function changeShowInPlan(data) {
      var _this16 = this;

      if (this.isDisablePrivilege) {
        return;
      } else {
        Object(_api_project_planRecord__WEBPACK_IMPORTED_MODULE_3__["showCatalongPlan"])({ id: data.id }).then(function (res) {
          if (res.success) {
            _this16.$message.success('设置成功');
            data.entity.showStatus = !data.entity.showStatus;
          }
        });
      }
    }
  }
});

/***/ })

}]);