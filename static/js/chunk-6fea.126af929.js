(this["webpackJsonp"] = this["webpackJsonp"] || []).push([["chunk-6fea"],{

/***/ "7AHz":
/*!*****************************************************************************************************!*\
  !*** ./src/views/project/BIM/fullLineModel/components/modelTree.vue?vue&type=template&id=a4db8146& ***!
  \*****************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_template_id_a4db8146___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../node_modules/vue-loader/lib??vue-loader-options!./modelTree.vue?vue&type=template&id=a4db8146& */ "rXS8");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_template_id_a4db8146___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_template_id_a4db8146___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "8dhy":
/*!**********************************************************************!*\
  !*** ./src/views/project/BIM/fullLineModel/components/modelTree.vue ***!
  \**********************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _modelTree_vue_vue_type_template_id_a4db8146___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./modelTree.vue?vue&type=template&id=a4db8146& */ "7AHz");
/* harmony import */ var _modelTree_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./modelTree.vue?vue&type=script&lang=js& */ "eUnx");
/* empty/unused harmony star reexport *//* harmony import */ var _modelTree_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./modelTree.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& */ "gnAH");
/* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "KHd+");






/* normalize component */

var component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_3__["default"])(
  _modelTree_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _modelTree_vue_vue_type_template_id_a4db8146___WEBPACK_IMPORTED_MODULE_0__["render"],
  _modelTree_vue_vue_type_template_id_a4db8146___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

component.options.__file = "modelTree.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "Mjni":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-0!./node_modules/css-loader??ref--11-1!./node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/lib??ref--11-2!./node_modules/sass-loader/lib/loader.js??ref--11-3!./node_modules/vue-loader/lib??vue-loader-options!./src/views/project/BIM/fullLineModel/components/modelTree.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

// extracted by mini-css-extract-plugin

/***/ }),

/***/ "QFjQ":
/*!**************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/happypack/loader.js?id=happyBabel!./node_modules/vue-loader/lib??vue-loader-options!./src/views/project/BIM/fullLineModel/components/modelTree.vue?vue&type=script&lang=js& ***!
  \**************************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babel_runtime_core_js_promise__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babel-runtime/core-js/promise */ "4d7F");
/* harmony import */ var babel_runtime_core_js_promise__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babel_runtime_core_js_promise__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! babel-runtime/regenerator */ "14Xm");
/* harmony import */ var babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var babel_runtime_core_js_get_iterator__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! babel-runtime/core-js/get-iterator */ "FyfS");
/* harmony import */ var babel_runtime_core_js_get_iterator__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(babel_runtime_core_js_get_iterator__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! babel-runtime/helpers/asyncToGenerator */ "D3Ub");
/* harmony import */ var babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! babel-runtime/helpers/extends */ "QbLZ");
/* harmony import */ var babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var _utils_renderer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/utils/renderer */ "MsMy");
/* harmony import */ var _api_project_bimFloder__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/api/project/bimFloder */ "lC0u");
/* harmony import */ var vuex__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! vuex */ "L2JU");





//
//
//
//
//
//
//
//
//
//
//
//
//
//

__webpack_require__(/*! infinite-tree/dist/infinite-tree.css */ "ZLQe");




var InfiniteTree = __webpack_require__(/*! infinite-tree/dist/infinite-tree.js */ "+17M");
/* harmony default export */ __webpack_exports__["default"] = ({
  name: 'ModelTree',
  props: {
    height: {
      type: String,
      default: ''
    },
    sceneList: {
      type: Array,
      default: function _default() {
        return [];
      }
    }
  },
  data: function data() {
    return {
      myTree: null,
      oldSelection: [],
      parentTreeNodeList: [],
      currentSceneList: [],
      oldSceneList: [],
      filterName: null
    };
  },

  computed: babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_4___default()({}, Object(vuex__WEBPACK_IMPORTED_MODULE_7__["mapGetters"])(['viewer', 'currentSelectModel', 'viewPointList'])),
  watch: {
    currentSelectModel: function currentSelectModel(val) {
      this.parentTreeNodeList = [];
      this.getTreeParentNode(val.sceneId.toString() + val.id.toString(), val.select);
    },
    sceneList: function sceneList(val) {
      var _this = this;

      return babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()( /*#__PURE__*/babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark(function _callee() {
        var temp, num, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, i;

        return babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _this.$store.dispatch('setIsLoad', false);
                _this.oldSelection = [];

                if (!(_this.currentSceneList && _this.currentSceneList.length > 0)) {
                  _context.next = 6;
                  break;
                }

                _this.appendOrDeleteNode(val);
                _context.next = 46;
                break;

              case 6:
                if (!(val && val.length > 0)) {
                  _context.next = 45;
                  break;
                }

                val.forEach(function (item) {
                  _this.currentSceneList.push(item);
                });
                // this.currentSceneList = val
                temp = [];
                num = 0;
                _iteratorNormalCompletion = true;
                _didIteratorError = false;
                _iteratorError = undefined;
                _context.prev = 13;
                _iterator = babel_runtime_core_js_get_iterator__WEBPACK_IMPORTED_MODULE_2___default()(val);

              case 15:
                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {
                  _context.next = 27;
                  break;
                }

                i = _step.value;

                console.info(i);
                _context.t0 = temp;
                _context.next = 21;
                return _this.getModelInfo(val[num]);

              case 21:
                _context.t1 = _context.sent;

                _context.t0.push.call(_context.t0, _context.t1);

                num++;

              case 24:
                _iteratorNormalCompletion = true;
                _context.next = 15;
                break;

              case 27:
                _context.next = 33;
                break;

              case 29:
                _context.prev = 29;
                _context.t2 = _context['catch'](13);
                _didIteratorError = true;
                _iteratorError = _context.t2;

              case 33:
                _context.prev = 33;
                _context.prev = 34;

                if (!_iteratorNormalCompletion && _iterator.return) {
                  _iterator.return();
                }

              case 36:
                _context.prev = 36;

                if (!_didIteratorError) {
                  _context.next = 39;
                  break;
                }

                throw _iteratorError;

              case 39:
                return _context.finish(36);

              case 40:
                return _context.finish(33);

              case 41:
                _this.initTree(temp);
                _this.$store.dispatch('setIsLoad', true);
                _context.next = 46;
                break;

              case 45:
                _this.$store.dispatch('setIsLoad', true);

              case 46:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, _this, [[13, 29, 33, 41], [34,, 36, 40]]);
      }))();
    }
  },
  created: function created() {},
  mounted: function mounted() {
    // this.getModelInfo()
  },

  methods: {
    appendOrDeleteNode: function appendOrDeleteNode(val) {
      var _this2 = this;

      return babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3___default()( /*#__PURE__*/babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.mark(function _callee2() {
        var _loop, i, num, flag, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, node, _node, vi;

        return babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default.a.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _loop = function _loop(i) {
                  if (val.findIndex(function (v) {
                    return v.sceneId === _this2.currentSceneList[i].sceneId;
                  }) === -1) {
                    if (_this2.myTree) {
                      var node = _this2.myTree.getNodeById(_this2.currentSceneList[i].sceneId);
                      if (node) {
                        _this2.myTree.removeNode(node);
                        _this2.currentSceneList.splice(i, 1);
                      }
                    }
                  }
                };

                for (i = _this2.currentSceneList.length - 1; i >= 0; i--) {
                  _loop(i);
                }
                num = 0;
                flag = false; // 用于判断视图是否重新渲染

                _iteratorNormalCompletion2 = true;
                _didIteratorError2 = false;
                _iteratorError2 = undefined;
                _context2.prev = 7;
                _iterator2 = babel_runtime_core_js_get_iterator__WEBPACK_IMPORTED_MODULE_2___default()(val);

              case 9:
                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {
                  _context2.next = 32;
                  break;
                }

                i = _step2.value;

                console.info(i);

                if (!(_this2.currentSceneList.findIndex(function (v) {
                  return v.sceneId === val[num].sceneId;
                }) === -1)) {
                  _context2.next = 26;
                  break;
                }

                node = _this2.myTree.getNodeById(val[num].sceneId);

                if (node) {
                  _context2.next = 23;
                  break;
                }

                _node = _this2.myTree.getNodeById('root');

                flag = true;
                _context2.t0 = _this2.myTree;
                _context2.next = 20;
                return _this2.getModelInfo({
                  sceneId: val[num].sceneId,
                  sceneVersion: val[num].sceneVersion
                });

              case 20:
                _context2.t1 = _context2.sent;
                _context2.t2 = _node;

                _context2.t0.appendChildNode.call(_context2.t0, _context2.t1, _context2.t2);

              case 23:
                _this2.currentSceneList.push(val[num]);
                _context2.next = 27;
                break;

              case 26:
                // 处理显示隐藏
                if (_this2.viewPointList[val[num].sceneId]) {
                  vi = _this2.viewPointList[val[num].sceneId];
                  // if (vi.isVisable) {
                  //
                  // }

                  if (vi.familyList && vi.familyList.length > 0) {
                    vi.familyList.forEach(function (item) {
                      var node = _this2.myTree.getNodeById(val[num].sceneId + item.id);
                      node.state.isVisible = !item.isVisable;
                      _this2.myTree.updateNode(node);
                    });
                  }
                  if (vi.familyTypeList && vi.familyTypeList.length > 0) {
                    vi.familyTypeList.forEach(function (item) {
                      var node = _this2.myTree.getNodeById(val[num].sceneId + item.id);
                      node.state.isVisible = !item.isVisable;
                      _this2.myTree.updateNode(node);
                    });
                  }
                }

              case 27:
                num++;
                if (flag) {
                  (function () {
                    var arr = [];
                    _this2.currentSceneList.forEach(function (item) {
                      if (!item.version) {
                        arr.push(item.sceneId);
                      } else {
                        arr.push(item.sceneId + '.' + item.version);
                      }
                    });
                    // this.viewer.adjustCameraBySceneIds(arr)
                  })();
                }

              case 29:
                _iteratorNormalCompletion2 = true;
                _context2.next = 9;
                break;

              case 32:
                _context2.next = 38;
                break;

              case 34:
                _context2.prev = 34;
                _context2.t3 = _context2['catch'](7);
                _didIteratorError2 = true;
                _iteratorError2 = _context2.t3;

              case 38:
                _context2.prev = 38;
                _context2.prev = 39;

                if (!_iteratorNormalCompletion2 && _iterator2.return) {
                  _iterator2.return();
                }

              case 41:
                _context2.prev = 41;

                if (!_didIteratorError2) {
                  _context2.next = 44;
                  break;
                }

                throw _iteratorError2;

              case 44:
                return _context2.finish(41);

              case 45:
                return _context2.finish(38);

              case 46:
                _this2.$store.dispatch('setIsLoad', true);

              case 47:
              case 'end':
                return _context2.stop();
            }
          }
        }, _callee2, _this2, [[7, 34, 38, 46], [39,, 41, 45]]);
      }))();
    },

    // 获取树上层结构
    getTreeParentNode: function getTreeParentNode(id, isSelected) {
      var _this3 = this;

      if (!this.myTree) {
        return false;
      }
      var node = this.myTree.getNodeById(id);
      this.parentTreeNodeList.unshift(node);
      if (node.parent && node.parent.id) {
        this.getTreeParentNode(node.parent.id, isSelected);
      } else {
        this.parentTreeNodeList.forEach(function (item) {
          _this3.myTree.openNode(item);
        });
        var treeNode = this.parentTreeNodeList[this.parentTreeNodeList.length - 1];
        if (this.oldSelection.findIndex(function (item) {
          return item === treeNode.id;
        }) === -1) {
          this.oldSelection.push(treeNode.id);
        }
        treeNode.state.checked = isSelected;
        // 获取所有选中模型
        var allSelectModels = [this.currentSelectModel];
        // 过滤取消的模型
        var _flag = false;
        this.oldSelection.forEach(function (item) {
          _flag = false;
          allSelectModels.forEach(function (model) {
            if (model.sceneId.toString() + model.id.toString() === item) {
              _flag = true;
            }
          });
          if (!_flag) {
            var temp = _this3.myTree.getNodeById(item);
            temp.state.checked = false;
            var _index = _this3.myTree.nodes.indexOf(temp);
            _this3.myTree.rows[_index] = _this3.myTree.options.rowRenderer(temp, _this3.myTree.options);
          }
        });
        var index = this.myTree.nodes.indexOf(treeNode);
        this.myTree.rows[index] = this.myTree.options.rowRenderer(treeNode, this.myTree.options);
        this.myTree.updateNode(treeNode);
        this.position(treeNode);
        // this.myTree.scrollTop([0])
        // setTimeout(() => {
        //   this.myTree.scrollToNode(treeNode)
        // }, 100)
      }
    },
    getModelInfo: function getModelInfo(val) {
      var _this4 = this;

      return new babel_runtime_core_js_promise__WEBPACK_IMPORTED_MODULE_0___default.a(function (resolve, reject) {
        Object(_api_project_bimFloder__WEBPACK_IMPORTED_MODULE_6__["getModelInfo"])(val.sceneId, val.sceneVersion).then(function (res) {
          if (res.models) {
            var temp = {};
            res.models.forEach(function (item) {
              var _loop2 = function _loop2(i) {
                if (!temp[item[i][1]]) {
                  temp[item[i][1]] = {};
                }
                if (!temp[item[i][1]][item[i][2]]) {
                  temp[item[i][1]][item[i][2]] = [];
                }
                // 判断是否视图反选，隐藏则改变状态
                var isVisible = false;
                if (_this4.viewPointList[val.sceneId]) {
                  var _temp = _this4.viewPointList[val.sceneId].modelList.find(function (mo) {
                    return mo.id === i;
                  });
                  if (_temp) {
                    isVisible = !_temp.isVisable;
                  }
                }
                temp[item[i][1]][item[i][2]].push({
                  name: i,
                  id: val.sceneId + i,
                  state: { isVisible: isVisible, isLeaf: true },
                  type: 'model',
                  sceneId: val.sceneId,
                  version: val.sceneVersion,
                  bizId: i
                });
              };

              for (var i in item) {
                _loop2(i);
              }
            });
            var isVisible = false;
            if (_this4.viewPointList[val.sceneId]) {
              isVisible = !_this4.viewPointList[val.sceneId].sceneVisable;
            }
            var modelList = [{
              id: val.sceneId,
              name: res.properties.scene[val.sceneId],
              children: [],
              type: 'scene',
              sceneId: val.sceneId,
              bizId: val.sceneId,
              version: val.sceneVersion,
              state: { isVisible: isVisible }
            }];
            var familyList = [];
            var tempTotal = 0;
            var allTotal = 0;

            var _loop3 = function _loop3(i) {
              familyList = [];
              tempTotal = 0;

              var _loop4 = function _loop4(type) {
                var isVisible = false;
                if (_this4.viewPointList[val.sceneId]) {
                  var _temp3 = _this4.viewPointList[val.sceneId].familyTypeList.find(function (mo) {
                    return mo.id === type;
                  });
                  if (_temp3) {
                    isVisible = !_temp3.isVisable;
                  }
                }
                familyList.push({
                  name: res.properties.familyType[type],
                  id: val.sceneId + type,
                  type: 'familyType',
                  sceneId: val.sceneId,
                  children: temp[i][type],
                  bizId: type,
                  version: val.sceneVersion,
                  state: { isVisible: isVisible, num: temp[i][type].length }
                });
                tempTotal += temp[i][type].length;
              };

              for (var type in temp[i]) {
                _loop4(type);
              }
              var isVisible = false;
              if (_this4.viewPointList[val.sceneId]) {
                var _temp2 = _this4.viewPointList[val.sceneId].familyList.find(function (mo) {
                  return mo.id === i;
                });
                if (_temp2) {
                  isVisible = !_temp2.isVisable;
                }
              }
              modelList[0].children.push({
                name: res.properties.family[i],
                id: val.sceneId + i,
                type: 'family',
                sceneId: val.sceneId,
                children: familyList,
                bizId: i,
                version: val.sceneVersion,
                state: { isVisible: isVisible, num: tempTotal }
              });
              allTotal += tempTotal;
            };

            for (var i in temp) {
              _loop3(i);
            }
            modelList[0].state.num = allTotal;
            resolve(modelList[0]);
            // this.initTree(modelList)
          }
        });
      });
    },
    position: function position(node) {
      // this.myTree.scrollToNode(this.myTree.getNodeById(id))
      var nodeIndex = this.myTree.nodes.indexOf(node);
      this.myTree.scrollTop(52 * (nodeIndex - 2));
    },
    changeInput: function changeInput() {
      this.searchKeyword(this.filterName);
    },
    initTree: function initTree(modelList) {
      var _this5 = this;

      this.myTree = new InfiniteTree({
        el: document.querySelector('#tree'),
        data: modelList,
        noCheckBox: true,
        shouldLoadNodes: function shouldLoadNodes(parentNode) {
          return !parentNode.hasChildren() && parentNode.loadOnDemand;
        },
        rowRenderer: _utils_renderer__WEBPACK_IMPORTED_MODULE_5__["default"],
        loadNodes: function loadNodes(parentNode, next) {
          var nodes = [];
          next(null, nodes, function () {});
          // setTimeout(function() {
          //   next(null, nodes, function() {
          //     // if (me.treeSearchNum < me.treeSearch.length - 2) {
          //     //   me.treeSearchNum++
          //     //   me.openTree(me.treeSearch[me.treeSearchNum])
          //     // } else {
          //     //   nodes.forEach(item => {
          //     //     if (item.id === me.treeSearch[me.treeSearch.length - 1]) {
          //     //       me.myTree.selectNode(me.myTree.getNodeById(item.id))
          //     //       me.myTree.scrollToNode(me.myTree.getNodeById(item.id))
          //     //     }
          //     //   })
          //     // }
          //   })
          // }, 1000)
        }
      });
      // let selectedNodes = []
      this.myTree.on('click', function (event) {
        // event.stopPropagation()
        event.target.classList.contains('eyeIcon') && _this5.onClickEye(event.target);
        event.target.classList.contains('checkbox') && _this5.onCheckBoxChecked(event.target);
        event.target.classList.contains('leaf-btn') && _this5.onClickModel(event.target);
      });
    },
    onClickModel: function onClickModel(target) {
      var treeNode = this.myTree.getNodeById(target.parentElement.parentElement.getAttribute('data-id'));
      if (!treeNode || !treeNode.state.isLeaf) {
        return;
      }
      var model = this.viewer.loader.getModel(treeNode.bizId);
      this.viewer.setViewport(null, null, model.center);
      // 显示衬条
      this.activeNode && this.activeNode.classList.remove('br-tree-node-active')(this.activeNode = target).classList.add('br-tree-node-active');
    },
    onCheckBoxChecked: function onCheckBoxChecked(target) {
      var _this6 = this;

      var tree = this.myTree;
      var treeNode = tree.getNodeById(target.parentElement.parentElement.parentElement.getAttribute('data-id'));
      var modelsNeedSelect = [];
      var modelsNeedUnSelect = [];
      var checked = target.checked;
      this.traverseAllChildren(treeNode, function (node) {
        node.state.checked = checked;
        var index = tree.nodes.indexOf(node);
        // 刚开始一些折叠起来的节点没加载过。
        if (index === -1) return;
        tree.rows[index] = tree.options.rowRenderer(node, tree.options);
      }, function (node) {
        if (node && node.id) {
          var model = _this6.viewer.loader.getModel(node.bizId);
          model.isSelected = checked;
          if (model.isSelected) {
            modelsNeedSelect.push(model.id);
          } else {
            modelsNeedUnSelect.push(model.id);
          }
        }
      });
      tree.update();
      this.viewer.unSelect(modelsNeedUnSelect);
      this.viewer.addSelection(modelsNeedSelect);
      // modelsNeedUnSelect.forEach((model) => {
      //   const index = this.oldSelection.indexOf(model)
      //   if (index !== -1) {
      //     this.oldSelection.splice(index, 1)
      //   } else {
      //     console.log('error: no selection was found')
      //   }
      // })
      // modelsNeedSelect.forEach((model) => {
      //   if (this.oldSelection.indexOf(model) === -1) {
      //     this.oldSelection.push(model)
      //   }
      // })
      // this.viewer.canvas.tabIndex = 1
      // this.viewer.canvas.focus()
      this.viewer.change();
    },
    onClickEye: function onClickEye(target) {
      var tree = this.myTree;
      var treeNode = tree.getNodeById(target.parentElement.parentElement.getAttribute('data-id'));
      if (treeNode.tag && treeNode.tag.type === 'scene' && !treeNode.tag.isLoaded) {
        treeNode.state.isVisible = true;
        // this.globals.sceneIds.push(treeNode.tag.id)
        // const index = tree.nodes.indexOf(treeNode)
        // tree.rows[index] = tree.options.rowRenderer(treeNode, tree.options)
        // this.treeService.showScene(this.treeRoot, treeNode, tree)
        return;
      }
      var toDisplay = target.classList.contains('iconbiyan');
      // if (!this.viewPointList[treeNode.sceneId]) {
      //   this.viewPointList[treeNode.sceneId] = {
      //     version: '',
      //     sceneVisable: true,
      //     familyList: [],
      //     familyTypeList: [],
      //     modelList: []
      //   }
      // }
      if (this.viewPointList[treeNode.sceneId]) {
        if (treeNode.type === 'scene') {
          this.viewPointList[treeNode.sceneId].sceneVisable = toDisplay;
        } else if (treeNode.type === 'family') {
          // 先判断有没有
          if (this.viewPointList[treeNode.sceneId].familyList.length > 0) {
            var temp = this.viewPointList[treeNode.sceneId].familyList.find(function (item) {
              return item.id === treeNode.bizId;
            });
            if (temp) {
              temp.isVisable = toDisplay;
            } else {
              this.viewPointList[treeNode.sceneId].familyList.push({ id: treeNode.bizId, isVisable: toDisplay });
            }
          } else {
            this.viewPointList[treeNode.sceneId].familyList.push({ id: treeNode.bizId, isVisable: toDisplay });
          }
        } else if (treeNode.type === 'familyType') {
          if (this.viewPointList[treeNode.sceneId].familyTypeList.length > 0) {
            var _temp4 = this.viewPointList[treeNode.sceneId].familyTypeList.find(function (item) {
              return item.id === treeNode.bizId;
            });
            if (_temp4) {
              _temp4.isVisable = toDisplay;
            } else {
              this.viewPointList[treeNode.sceneId].familyTypeList.push({ id: treeNode.bizId, isVisable: toDisplay });
            }
          } else {
            this.viewPointList[treeNode.sceneId].familyTypeList.push({ id: treeNode.bizId, isVisable: toDisplay });
          }
        } else if (treeNode.type === 'model') {
          if (this.viewPointList[treeNode.sceneId].modelList.length > 0) {
            var _temp5 = this.viewPointList[treeNode.sceneId].modelList.find(function (item) {
              return item.id === treeNode.bizId;
            });
            if (_temp5) {
              _temp5.isVisable = toDisplay;
            } else {
              this.viewPointList[treeNode.sceneId].modelList.push({ id: treeNode.bizId, isVisable: toDisplay });
            }
          } else {
            this.viewPointList[treeNode.sceneId].modelList.push({ id: treeNode.bizId, isVisable: toDisplay });
          }
        }
        this.$store.dispatch('setViewPointList', this.viewPointList);
      }
      var modelsNeedUpdate = [];
      // 更新选择视图数据
      if (toDisplay) {
        this.traverseAllChildren(treeNode, function (node) {
          node.state.isVisible = false;
          // if (node.tag && node.tag.type === 'scene') {
          //   this.treeService.showScene(this.treeRoot, node)
          // }
          var index = tree.nodes.indexOf(node);
          tree.rows[index] = tree.options.rowRenderer(node, tree.options);
        }, function (node) {
          if (!modelsNeedUpdate[node.sceneId + '_' + (node.version ? node.version : '65536')]) {
            modelsNeedUpdate[node.sceneId + '_' + (node.version ? node.version : '65536')] = [];
          }
          modelsNeedUpdate[node.sceneId + '_' + (node.version ? node.version : '65536')].push({
            id: node.bizId,
            isVisable: toDisplay
          });
        });
        var arr = [];
        for (var i in modelsNeedUpdate) {
          arr.push({
            tileset: this.$parent.$refs.cesium.getTileset(i),
            familyList: [],
            familyTypeList: [],
            modelList: modelsNeedUpdate[i],
            sceneId: i,
            version: null,
            isVisable: true
          });
        }
        this.$parent.$refs.cesium.tilesetVisible(arr);
      } else {
        this.traverseAllChildren(treeNode, function (node) {
          node.state.isVisible = true;
          var index = tree.nodes.indexOf(node);
          tree.rows[index] = tree.options.rowRenderer(node, tree.options);
        }, function (node) {
          // const model = this.viewer.loader.getModel(node.bizId)
          if (!modelsNeedUpdate[node.sceneId + '_' + (node.version ? node.version : '65536')]) {
            modelsNeedUpdate[node.sceneId + '_' + (node.version ? node.version : '65536')] = [];
          }
          modelsNeedUpdate[node.sceneId + '_' + (node.version ? node.version : '65536')].push({
            id: node.bizId,
            isVisable: toDisplay
          });
        });
        var _arr = [];
        for (var _i in modelsNeedUpdate) {
          _arr.push({
            tileset: this.$parent.$refs.cesium.getTileset(_i),
            familyList: [],
            familyTypeList: [],
            modelList: modelsNeedUpdate[_i],
            sceneId: _i,
            version: null,
            isVisable: true
          });
        }
        this.$parent.$refs.cesium.tilesetVisible(_arr);
      }
      tree.update();
      // this.viewer.change()
    },
    traverseAllChildren: function traverseAllChildren(node, callback, leafCallback) {
      var _this7 = this;

      callback && callback(node);
      if (!node.children || !node.children.length) {
        leafCallback && leafCallback(node);
      } else {
        var childNodes = node.children;
        childNodes.forEach(function (child) {
          return _this7.traverseAllChildren(child, callback, leafCallback);
        });
      }
    },
    searchKeyword: function searchKeyword(keyword) {
      var filterOptions = {
        caseSensitive: false,
        exactMatch: false,
        filterPath: 'name', // Defaults to 'name'
        includeAncestors: true,
        includeDescendants: true
      };
      this.myTree.filter(keyword, filterOptions);
    },

    // // 取消选择
    // cancel() {
    //   this.$emit('goList')
    // },
    // 保存选择
    ok: function ok() {
      this.$emit('goList');
    }
  }
});

/***/ }),

/***/ "eUnx":
/*!***********************************************************************************************!*\
  !*** ./src/views/project/BIM/fullLineModel/components/modelTree.vue?vue&type=script&lang=js& ***!
  \***********************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_happypack_loader_js_id_happyBabel_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../node_modules/happypack/loader.js?id=happyBabel!../../../../../../node_modules/vue-loader/lib??vue-loader-options!./modelTree.vue?vue&type=script&lang=js& */ "QFjQ");
/* empty/unused harmony star reexport */ /* harmony default export */ __webpack_exports__["default"] = (_node_modules_happypack_loader_js_id_happyBabel_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__["default"]); 

/***/ }),

/***/ "gnAH":
/*!******************************************************************************************************************************!*\
  !*** ./src/views/project/BIM/fullLineModel/components/modelTree.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& ***!
  \******************************************************************************************************************************/
/*! no static exports found */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-0!../../../../../../node_modules/css-loader??ref--11-1!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/lib??ref--11-2!../../../../../../node_modules/sass-loader/lib/loader.js??ref--11-3!../../../../../../node_modules/vue-loader/lib??vue-loader-options!./modelTree.vue?vue&type=style&index=0&rel=stylesheet%2Fscss&lang=scss& */ "Mjni");
/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__);
/* harmony reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== 'default') (function(key) { __webpack_require__.d(__webpack_exports__, key, function() { return _node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0__[key]; }) }(__WEBPACK_IMPORT_KEY__));
 /* harmony default export */ __webpack_exports__["default"] = (_node_modules_mini_css_extract_plugin_dist_loader_js_ref_11_0_node_modules_css_loader_index_js_ref_11_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_11_2_node_modules_sass_loader_lib_loader_js_ref_11_3_node_modules_vue_loader_lib_index_js_vue_loader_options_modelTree_vue_vue_type_style_index_0_rel_stylesheet_2Fscss_lang_scss___WEBPACK_IMPORTED_MODULE_0___default.a); 

/***/ }),

/***/ "rXS8":
/*!***********************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??vue-loader-options!./src/views/project/BIM/fullLineModel/components/modelTree.vue?vue&type=template&id=a4db8146& ***!
  \***********************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"fullLineTree",attrs:{"id":"modelView"}},[_c('el-input',{ref:"filterInput",staticClass:"filterInput",attrs:{"id":"filterInput","prefix-icon":"el-icon-search","placeholder":"请输入"},on:{"input":_vm.changeInput},model:{value:(_vm.filterName),callback:function ($$v) {_vm.filterName=$$v},expression:"filterName"}}),_vm._v(" "),_c('div',{style:({height:_vm.height}),attrs:{"id":"tree"}}),_vm._v(" "),_c('div',{staticClass:"flex"},[_c('el-button',{attrs:{"type":"primary","size":"mini"},on:{"click":_vm.ok}},[_vm._v("确定")])],1)],1)}
var staticRenderFns = []



/***/ })

}]);